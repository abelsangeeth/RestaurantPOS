@model RestaurantPOS.Models.POSViewModel
@{
    ViewData["Title"] = "Restaurant POS System";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { box-sizing: border-box; }
        .table-occupied { background-color: #ef4444; }
        .table-available { background-color: #10b981; }
        .table-reserved { background-color: #f59e0b; }
        .receipt-print { font-family: 'Courier New', monospace; }
        @@media print {
            .no-print { display: none; }
            .receipt-print { font-size: 12px; }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        .notification.success { background-color: #10b981; }
        .notification.error { background-color: #ef4444; }
        @@keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    @if (Model.CurrentUser ==null)
    {
        <!-- Login View -->
        <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800">
            <div class="max-w-md w-full space-y-8 p-8">
                <div class="text-center">
                    <div class="text-6xl mb-4">🏪</div>
                    <h2 class="text-4xl font-bold text-white mb-2">@Model.RestaurantName</h2>
                    <p class="text-xl text-blue-100 mb-8">POS System Login</p>
                </div>

                <div class="bg-white rounded-xl shadow-2xl p-8">
                    <form method="post" action="/Login/Login" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">👤 Username</label>
                            <input type="text" name="username" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter username" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">🔒 Password</label>
                            <input type="password" name="password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter password" required>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 font-bold shadow-lg transform hover:scale-105 transition-all">
                            🚀 Login to POS System
                        </button>
                    </form>

                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-bold text-gray-700 mb-2">Demo Credentials:</h4>
                        <div class="text-sm text-gray-600 space-y-1">
                            <p><strong>Admin:</strong> admin / admin123</p>
                            <p><strong>Manager:</strong> manager / manager123</p>
                            <p><strong>Owner:</strong> owner / owner123</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- Main Application -->
        <div class="min-h-screen flex flex-col">
            <!-- Header -->
            <header class="bg-gray-800 text-white p-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold">@Model.RestaurantName</h1>
                        <div class="text-sm opacity-75">@Model.ContactInfo</div>
                    </div>
                    <div class="flex items-center space-x-6">
                        <div class="text-right">
                            <div class="text-sm opacity-75">Current User</div>
                            <div class="font-bold">@Model.CurrentUser.Name (@Model.CurrentUser.Role)</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm opacity-75">Date & Time</div>
                            <div class="font-bold" id="currentDateTime">@DateTime.Now.ToString("f")</div>
                        </div>
                        <form method="post" action="/POS/Logout">
                            <button type="submit" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-medium transition-colors">
                                🚪 Logout
                            </button>
                        </form>
                    </div>
                </div>
            </header>

            <!-- Navigation -->
            <nav class="bg-white shadow-sm border-b">
                <div class="flex space-x-1 p-4 overflow-x-auto">
                    <button onclick="showView('dashboard')" class="nav-btn px-4 py-2 rounded-lg bg-blue-600 text-white font-medium transition-colors">
                        Dashboard
                    </button>
                    <button onclick="showView('tables')" class="nav-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium transition-colors">
                        Tables
                    </button>
                    <button onclick="showView('orders')" class="nav-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium transition-colors">
                        Orders
                    </button>
                    <button onclick="showView('menu')" class="nav-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium transition-colors">
                        Menu & Orders
                    </button>
                    <button onclick="showView('kitchen')" class="nav-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium transition-colors">
                        Kitchen
                    </button>
                    <button onclick="showView('reports')" class="nav-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium transition-colors">
                        Reports
                    </button>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="flex-1 p-6">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view">
                    <!-- Welcome Header -->
                    <div class="bg-gradient-to-r from-blue-600 to-purple-700 text-white p-8 rounded-xl shadow-xl mb-8">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-4xl font-bold mb-2">🏪 Welcome to Dashboard</h2>
                                <p class="text-xl opacity-90">Real-time restaurant analytics and insights</p>
                                <p class="text-lg opacity-75 mt-2">📅 @DateTime.Now.ToString("D") | 🕒 @DateTime.Now.ToString("t")</p>
                            </div>
                            <div class="text-right">
                                <div class="text-6xl mb-2">📊</div>
                                <p class="text-lg font-semibold">Live Data</p>
                            </div>
                        </div>
                    </div>

                    <!-- Key Metrics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl shadow-xl transform hover:scale-105 transition-all">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">💰 Today's Sales</p>
                                    <p class="text-4xl font-bold">$@Model.TodaySales.ToString("F2")</p>
                                </div>
                                <div class="text-5xl opacity-80">💵</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-xl transform hover:scale-105 transition-all">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm font-medium">🔥 Active Orders</p>
                                    <p class="text-4xl font-bold">@Model.ActiveOrdersCount</p>
                                </div>
                                <div class="text-5xl opacity-80">📋</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-xl transform hover:scale-105 transition-all">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">🪑 Table Status</p>
                                    <p class="text-4xl font-bold">@Model.OccupiedTablesCount/@Model.Tables.Count</p>
                                </div>
                                <div class="text-5xl opacity-80">🍽️</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-xl transform hover:scale-105 transition-all">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm font-medium">🍽️ Menu Items</p>
                                    <p class="text-4xl font-bold">@Model.MenuItems.Count</p>
                                </div>
                                <div class="text-5xl opacity-80">📋</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-xl">
                        <h3 class="text-2xl font-bold mb-6 text-gray-800">⚡ Quick Actions</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="showView('tables')" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg text-center">
                                <div class="text-3xl mb-2">🪑</div>
                                <div class="font-bold">Manage Tables</div>
                            </button>
                            <button onclick="showView('orders')" class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg text-center">
                                <div class="text-3xl mb-2">📋</div>
                                <div class="font-bold">View Orders</div>
                            </button>
                            <button onclick="showView('menu')" class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg text-center">
                                <div class="text-3xl mb-2">🍽️</div>
                                <div class="font-bold">Manage Menu</div>
                            </button>
                            <button onclick="showView('kitchen')" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg text-center">
                                <div class="text-3xl mb-2">👨‍🍳</div>
                                <div class="font-bold">Kitchen View</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tables View -->
                <!-- Tables View -->
                <div id="tables-view" class="view hidden">
                    <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-xl shadow-xl mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-3xl font-bold mb-2">🪑 Table Management</h2>
                                <p class="text-blue-100">Manage reservations, orders, and table settings</p>
                            </div>
                            <button onclick="showAddTableForm()" class="bg-white text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 font-bold shadow-lg transform hover:scale-105 transition-all">
                                ➕ Add New Table
                            </button>
                        </div>
                    </div>

                    <!-- Table Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white p-4 rounded-lg shadow text-center">
                            <div class="text-2xl font-bold text-gray-800">@Model.Tables.Count</div>
                            <div class="text-sm text-gray-600">Total Tables</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow text-center">
                            <div class="text-2xl font-bold text-green-600">@Model.Tables.Count(t => t.Status == "available")</div>
                            <div class="text-sm text-gray-600">Available</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow text-center">
                            <div class="text-2xl font-bold text-red-600">@Model.Tables.Count(t => t.Status == "occupied")</div>
                            <div class="text-sm text-gray-600">Occupied</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow text-center">
                            <div class="text-2xl font-bold text-yellow-600">@Model.Tables.Count(t => t.Status == "reserved")</div>
                            <div class="text-sm text-gray-600">Reserved</div>
                        </div>
                    </div>

                    <!-- Tables Grid -->
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        @foreach (var table in Model.Tables)
                        {
                            <div onclick="handleTableClick(@table.Id, '@table.Status')"
                                 class="table-item p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-lg relative group
                        @(table.Status == "occupied" ? "table-occupied text-white" :
                          table.Status == "reserved" ? "table-reserved text-white" :
                          "table-available text-white")">
                                <div class="text-center">
                                    <div class="text-2xl font-bold">T@(table.Id)</div>
                                    <div class="text-sm capitalize">@table.Status</div>
                                    @if (table.Capacity.HasValue)
                                    {
                                        <div class="text-xs">👥 @table.Capacity seats</div>
                                    }
                                    @if (table.CurrentOrder != null)
                                    {
                                        <div class="text-xs mt-1 font-semibold">$@table.CurrentOrder.Total.ToString("F2")</div>
                                    }
                                    @if (!string.IsNullOrEmpty(table.Location))
                                    {
                                        <div class="text-xs opacity-75">@table.Location</div>
                                    }
                                </div>

                                <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button onclick="event.stopPropagation(); showTableOptions(@table.Id)"
                                            class="bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70 transition-all">
                                        ⚙️
                                    </button>
                                </div>
                            </div>
                        }
                    </div>
                </div>

               
             
                <!-- Table Options Modal -->
                <div id="tableOptionsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 rounded-t-xl sticky top-0 z-10">
                            <div class="flex justify-between items-center">
                                <h2 class="text-2xl font-bold">Table <span id="tableOptionsNumber">1</span> Options</h2>
                                <button type="button" onclick="closeModal('tableOptionsModal')"
                                        class="text-white hover:text-gray-200 text-2xl font-bold">
                                    ✕
                                </button>
                            </div>
                            <div class="mt-2">
                                <div class="flex items-center space-x-2">
                                    <span class="text-blue-100">Current Status:</span>
                                    <span id="tableCurrentStatus" class="px-3 py-1 rounded-full text-sm font-bold bg-white text-blue-700">
                                        Available
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Options Content -->
                        <div class="p-6">
                            <input type="hidden" id="tableOptionsTableId" value="">

                            <!-- Action Buttons -->
                            <div class="grid grid-cols-2 gap-3 mb-6">
                                <!-- Start Order Button -->
                                <button onclick="startTableOrder()"
                                        class="bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 font-bold transition-all flex items-center justify-center space-x-2">
                                    <span>🛒</span>
                                    <span>Start Order</span>
                                </button>

                                <!-- Reserve Table Button -->
                                <button onclick="showReservationForm()"
                                        class="bg-yellow-600 text-white py-3 px-4 rounded-lg hover:bg-yellow-700 font-bold transition-all flex items-center justify-center space-x-2">
                                    <span>📅</span>
                                    <span>Reserve</span>
                                </button>

                                <!-- Edit Settings Button -->
                                <button onclick="editTableSettings()"
                                        class="bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 font-bold transition-all flex items-center justify-center space-x-2">
                                    <span>⚙️</span>
                                    <span>Settings</span>
                                </button>

                                <!-- View History Button -->
                                <button onclick="viewTableHistory()"
                                        class="bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 font-bold transition-all flex items-center justify-center space-x-2">
                                    <span>📊</span>
                                    <span>History</span>
                                </button>
                            </div>

                            <!-- Reservation Form (Initially Hidden) -->
                            <div id="reservationForm" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <h3 class="text-lg font-bold text-yellow-800 mb-3">📅 Reserve Table</h3>

                                <form id="reservationFormData" class="space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium text-yellow-700 mb-1">Customer Name *</label>
                                        <input type="text" name="customerName" required
                                               class="w-full p-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                               placeholder="Enter customer name">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-yellow-700 mb-1">Phone Number *</label>
                                        <input type="tel" name="customerPhone" required
                                               class="w-full p-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                               placeholder="Enter phone number">
                                    </div>

                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-medium text-yellow-700 mb-1">Reservation Date *</label>
                                            <input type="date" name="reservationDate" required
                                                   class="w-full p-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-yellow-700 mb-1">Time *</label>
                                            <input type="time" name="reservationTime" required
                                                   class="w-full p-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-yellow-700 mb-1">Party Size *</label>
                                        <select name="partySize" required
                                                class="w-full p-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500">
                                            <option value="">Select party size</option>
                                            <option value="1">1 person</option>
                                            <option value="2">2 people</option>
                                            <option value="3">3 people</option>
                                            <option value="4">4 people</option>
                                            <option value="5">5 people</option>
                                            <option value="6">6 people</option>
                                            <option value="7">7 people</option>
                                            <option value="8">8 people</option>
                                            <option value="9">9 people</option>
                                            <option value="10">10+ people</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-yellow-700 mb-1">Special Requests</label>
                                        <textarea name="specialRequests" rows="2"
                                                  class="w-full p-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500"
                                                  placeholder="Any special requirements..."></textarea>
                                    </div>

                                    <div class="flex space-x-3 pt-2">
                                        <button type="submit"
                                                class="flex-1 bg-yellow-600 text-white py-2 rounded-lg hover:bg-yellow-700 font-bold transition-all">
                                            ✅ Confirm Reservation
                                        </button>
                                        <button type="button" onclick="hideReservationForm()"
                                                class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 font-bold transition-all">
                                            ❌ Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Current Order Info (if table is occupied) -->
                            <div id="currentOrderInfo" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <h3 class="text-lg font-bold text-blue-800 mb-2">🛒 Current Order</h3>
                                <div id="orderDetailsContent">
                                    <!-- Order details will be loaded here -->
                                </div>
                                <div class="mt-3 flex space-x-2">
                                    <button onclick="addMoreItems()"
                                            class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 font-bold transition-all text-sm">
                                        ➕ Add Items
                                    </button>
                                    <button onclick="closeTableOrder()"
                                            class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 font-bold transition-all text-sm">
                                        💳 Close Order
                                    </button>
                                </div>
                            </div>

                            <!-- Reservation Info (if table is reserved) -->
                            <div id="reservationInfo" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <h3 class="text-lg font-bold text-yellow-800 mb-2">📅 Reservation Details</h3>
                                <div id="reservationDetailsContent">
                                    <!-- Reservation details will be loaded here -->
                                </div>
                                <div class="mt-3 flex space-x-2">
                                    <button onclick="checkInReservation()"
                                            class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 font-bold transition-all text-sm">
                                        ✅ Check In
                                    </button>
                                    <button onclick="cancelReservation()"
                                            class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 font-bold transition-all text-sm">
                                        ❌ Cancel
                                    </button>
                                </div>
                            </div>

                            <!-- Close Button -->
                            <div class="mt-6">
                                <button type="button" onclick="closeModal('tableOptionsModal')"
                                        class="w-full bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-bold transition-all">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Enhanced Add Table Modal -->
                <div id="addTableModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                    <div class="bg-white p-8 rounded-xl max-w-md w-full mx-4 shadow-2xl">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">➕ Add New Table</h2>
                            <button type="button" onclick="closeModal('addTableModal')" class="text-gray-500 hover:text-gray-700 text-2xl">✕</button>
                        </div>
                        <form id="addTableForm" class="space-y-4">
                            @Html.AntiForgeryToken()
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">🔢 Table Number</label>
                                <input type="number" id="newTableNumber" name="tableNumber" min="1" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">👥 Table Capacity</label>
                                <select name="capacity" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                    <option value="2">2 seats</option>
                                    <option value="4" selected>4 seats</option>
                                    <option value="6">6 seats</option>
                                    <option value="8">8 seats</option>
                                    <option value="10">10 seats</option>
                                    <option value="12">12 seats</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">📍 Location</label>
                                <select name="location" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="Main Dining">Main Dining</option>
                                    <option value="Window Side">Window Side</option>
                                    <option value="Patio">Patio</option>
                                    <option value="Private Room">Private Room</option>
                                    <option value="Bar Area">Bar Area</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">🏷️ Table Type</label>
                                <select name="type" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="Regular">Regular Table</option>
                                    <option value="Booth">Booth</option>
                                    <option value="High Top">High Top</option>
                                    <option value="Round">Round Table</option>
                                    <option value="Communal">Communal Table</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">📝 Notes (Optional)</label>
                                <textarea name="notes" placeholder="Any special notes about this table..." class="w-full p-3 border rounded-lg h-20 resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <div class="flex space-x-4 mt-6">
                                <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 font-bold shadow-lg transform hover:scale-105 transition-all">
                                    ✅ Create Table
                                </button>
                                <button type="button" onclick="closeModal('addTableModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-bold transition-all">
                                    ❌ Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Orders View -->
                <div id="orders-view" class="view hidden">
                    <div class="bg-gradient-to-r from-orange-600 to-orange-700 text-white p-6 rounded-xl shadow-xl mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-3xl font-bold mb-2">📋 Order Management</h2>
                                <p class="text-orange-100">Manage all restaurant orders in one place</p>
                            </div>
                            <div class="text-right">
                                <div class="text-4xl mb-2">🛒</div>
                                <div class="text-sm opacity-90">Total Orders: <span id="totalOrdersCount">0</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white p-4 rounded-lg shadow text-center cursor-pointer hover:shadow-lg transition-all" onclick="filterOrders('all')">
                            <div class="text-2xl font-bold text-gray-800" id="allOrdersCount">0</div>
                            <div class="text-sm text-gray-600">All Orders</div>
                            <div class="text-xs text-blue-600 mt-1">📋 View All</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow text-center cursor-pointer hover:shadow-lg transition-all" onclick="filterOrders('dine-in')">
                            <div class="text-2xl font-bold text-green-600" id="dineInOrdersCount">0</div>
                            <div class="text-sm text-gray-600">Dine In</div>
                            <div class="text-xs text-green-600 mt-1">🍽️ Restaurant</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow text-center cursor-pointer hover:shadow-lg transition-all" onclick="filterOrders('delivery')">
                            <div class="text-2xl font-bold text-purple-600" id="deliveryOrdersCount">0</div>
                            <div class="text-sm text-gray-600">Delivery</div>
                            <div class="text-xs text-purple-600 mt-1">🚚 Home Delivery</div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow text-center cursor-pointer hover:shadow-lg transition-all" onclick="filterOrders('takeaway')">
                            <div class="text-2xl font-bold text-orange-600" id="takeawayOrdersCount">0</div>
                            <div class="text-sm text-gray-600">Take Away</div>
                            <div class="text-xs text-orange-600 mt-1">🥡 Pickup</div>
                        </div>
                    </div>

                    <!-- Order Filters -->
                    <div class="bg-white p-4 rounded-lg shadow-lg mb-6">
                        <div class="flex flex-wrap gap-4 items-center">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Filter by Type:</label>
                                <select id="orderTypeFilter" onchange="filterOrders(this.value)" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <option value="all">All Order Types</option>
                                    <option value="dine-in">🍽️ Dine In</option>
                                    <option value="delivery">🚚 Delivery</option>
                                    <option value="takeaway">🥡 Take Away</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Filter by Status:</label>
                                <select id="orderStatusFilter" onchange="filterOrdersByStatus(this.value)" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                    <option value="all">All Statuses</option>
                                    <option value="pending">⏳ Pending</option>
                                    <option value="preparing">👨‍🍳 Preparing</option>
                                    <option value="ready">✅ Ready</option>
                                    <option value="completed">📦 Completed</option>
                                    <option value="cancelled">❌ Cancelled</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Date Range:</label>
                                <input type="date" id="orderDateFilter" onchange="filterOrdersByDate()" class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            </div>

                            <div class="flex-1 min-w-[200px]">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Search Orders:</label>
                                <input type="text" id="orderSearch" placeholder="Search by order #, customer..."
                                       onkeyup="searchOrders()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                            </div>

                            <div class="mt-6">
                                <button onclick="refreshOrders()" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                                    🔄 Refresh
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6" id="orders-container">
                        <!-- Orders will be loaded here dynamically -->
                    </div>

                    <!-- No Orders Message -->
                    <div id="no-orders-message" class="hidden text-center py-12">
                        <div class="text-6xl mb-4">📋</div>
                        <h3 class="text-2xl font-bold text-gray-600 mb-2">No Orders Found</h3>
                        <p class="text-gray-500">There are no orders matching your current filters.</p>
                    </div>
                </div>

              
                <!-- Menu View -->
                <div id="menu-view" class="view hidden">
                    <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 rounded-xl shadow-xl mb-6">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-2xl font-bold mb-2">🍽️ Menu Management</h3>
                                <p class="text-purple-100">Manage your restaurant menu and take orders</p>
                            </div>
                            <button onclick="showAddMenuItemForm()" class="bg-white text-purple-600 px-6 py-3 rounded-lg hover:bg-purple-50 font-bold shadow-lg transform hover:scale-105 transition-all">
                                ➕ Add New Item
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="bg-white p-4 rounded-lg shadow-lg mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4">📋 Menu Items (@Model.MenuItems.Count)</h4>
                                <div class="flex flex-wrap gap-2">
                                    @foreach (var category in Model.MenuItems.Select(m => m.Category).Distinct())
                                    {
                                        <button onclick="filterMenu('@category')" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
                                            @category
                                        </button>
                                    }
                                    <button onclick="filterMenu('all')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        All Items
                                    </button>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="menu-items-container">
                                @foreach (var item in Model.MenuItems)
                                {
                                    <div class="menu-item bg-white p-4 rounded-lg shadow hover:shadow-lg transition-all border border-gray-200" data-category="@item.Category">
                                        <div class="flex justify-between items-start mb-3">
                                            <h4 class="font-bold text-lg text-gray-800">@item.Name</h4>
                                            <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">@item.Category</span>
                                        </div>
                                        @if (!string.IsNullOrEmpty(item.Description))
                                        {
                                            <p class="text-sm text-gray-500 mb-3">@item.Description</p>
                                        }
                                        <div class="flex justify-between items-center">
                                            <p class="text-xl font-bold text-green-600">$@item.Price.ToString("F2")</p>
                                            <button onclick="addToOrder(@item.Id, '@item.Name')"
                                                    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium">
                                                ➕ Add to Order
                                            </button>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>

                       
                        <!-- Order Panel -->
                        <div class="bg-white p-6 rounded-lg shadow-lg sticky top-4">
                            <h3 class="text-xl font-bold mb-4">🛒 Current Order</h3>

                            <!-- Order Items Container -->
                            <div class="mb-4 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50" id="current-order-items">
                                @if (Model.CurrentOrder?.Items?.Any() == true)
                                {
                                    @foreach (var item in Model.CurrentOrder.Items)
                                    {
                                        <div class="flex justify-between items-center py-2 border-b border-gray-200 last:border-b-0" id="order-item-@item.MenuItemId">
                                            <div class="flex-1">
                                                <div class="font-medium text-gray-800">@item.Name</div>
                                                <div class="text-sm text-gray-600">$@item.Price.ToString("F2") × @item.Quantity</div>
                                            </div>
                                            <div class="flex items-center space-x-2 ml-4">
                                                <button onclick="updateQuantity(@item.MenuItemId, -1)"
                                                        class="bg-red-500 text-white w-6 h-6 rounded-full text-sm hover:bg-red-600 transition-colors flex items-center justify-center">
                                                    −
                                                </button>
                                                <span class="w-8 text-center font-bold text-gray-700">@item.Quantity</span>
                                                <button onclick="updateQuantity(@item.MenuItemId, 1)"
                                                        class="bg-green-500 text-white w-6 h-6 rounded-full text-sm hover:bg-green-600 transition-colors flex items-center justify-center">
                                                    +
                                                </button>
                                            </div>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="text-center py-8 text-gray-500">
                                        <div class="text-4xl mb-2">🛒</div>
                                        <p>No items added to order</p>
                                        <p class="text-sm mt-1">Add items from the menu</p>
                                    </div>
                                }
                            </div>

                            <!-- Order Summary -->
                            <div class="border-t border-gray-300 pt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">Subtotal:</span>
                                    <span class="text-sm text-gray-600" id="subtotal-amount">$@(Model.CurrentOrder?.Items?.Sum(i => i.Price * i.Quantity).ToString("F2") ?? "0.00")</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">Tax (10%):</span>
                                    <span class="text-sm text-gray-600" id="tax-amount">$@((Model.CurrentOrder?.Items?.Sum(i => i.Price * i.Quantity) * 0.10m ?? 0).ToString("F2"))</span>
                                </div>
                                <div class="flex justify-between items-center text-xl font-bold mb-4 border-t border-gray-300 pt-2">
                                    <span class="text-gray-800">Total:</span>
                                    <span class="text-green-600" id="total-amount">$@(Model.CurrentOrder?.Total.ToString("F2") ?? "0.00")</span>
                                </div>

                                <!-- Order Details Form -->
                                <form method="post" asp-action="ProcessOrder" asp-controller="POS" id="process-order-form" class="space-y-3">
                                    @Html.AntiForgeryToken()

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">📋 Order Type</label>
                                        <select name="orderType" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                            <option value="">Select order type</option>
                                            <option value="dine-in">🍽️ Dine In</option>
                                            <option value="takeaway">🥡 Takeaway</option>
                                            <option value="delivery">🚚 Delivery</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">👤 Customer Name</label>
                                        <input type="text" name="customerName" placeholder="Enter customer name"
                                               class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                               required value="@(Model.CurrentOrder?.CustomerName ?? "")">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">📞 Customer Phone</label>
                                        <input type="text" name="customerPhone" placeholder="Enter phone number"
                                               class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                               value="@(Model.CurrentOrder?.CustomerPhone ?? "")">
                                    </div>

                                    <div id="table-input-container" class="hidden">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">🪑 Table Number</label>
                                        <select name="tableId" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="">Select table</option>
                                            @foreach (var table in Model.Tables.Where(t => t.Status == "available"))
                                            {
                                                <option value="@table.Id">Table @table.Id (@table.Capacity seats)</option>
                                            }
                                        </select>
                                    </div>

                                    <div class="pt-2">
                                        <button type="submit"
                                                id="process-order-btn"
                                                class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg hover:from-green-700 hover:to-green-800 transition-all font-bold shadow-lg transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                        @(Model.CurrentOrder?.Items?.Any() != true ? "disabled" : "")>
                                            <span id="process-order-text">
                                                💳 Process Order
                                            </span>
                                            <span id="process-order-loading" class="hidden">
                                                ⏳ Processing...
                                            </span>
                                        </button>

                                        @if (Model.CurrentOrder?.Items?.Any() != true)
                                        {
                                            <p class="text-xs text-red-500 text-center mt-2">Add items to order first</p>
                                        }
                                    </div>
                                </form>

                                <!-- Clear Order Button -->
                                @if (Model.CurrentOrder?.Items?.Any() == true)
                                {
                                    <div class="mt-3 pt-3 border-t border-gray-300">
                                        <button onclick="clearOrder()"
                                                class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors font-medium">
                                            🗑️ Clear Order
                                        </button>
                                    </div>
                                }
                            </div>
                        </div>
                <!-- Kitchen View -->
                <!-- Kitchen View -->
                <div id="kitchen-view" class="view hidden">
                    <h2 class="text-2xl font-bold mb-6">Kitchen Order Tickets</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        @foreach (var order in Model.Orders.Where(o => o.Status == "pending" || o.Status == "preparing"))
                        {
                            <div class="bg-white rounded-lg shadow-lg border border-gray-200 p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <!-- Fixed: Use OrderNumber for KOT display -->
                                    <h3 class="text-lg font-bold">KOT #@order.OrderNumber</h3>
                                    <span class="px-2 py-1 rounded-full text-xs font-bold
                        @(order.Status == "pending" ? "bg-yellow-100 text-yellow-800" : "bg-blue-100 text-blue-800")">
                                        @order.Status
                                    </span>
                                </div>
                                <div class="space-y-2 mb-4">
                                    <p><strong>Customer:</strong> @order.CustomerName</p>
                                    <p><strong>Type:</strong> @order.OrderType</p>
                                    <p><strong>Items:</strong></p>
                                    <ul class="list-disc list-inside text-sm">
                                        @foreach (var item in order.Items)
                                        {
                                            <li>@item.Name x@(item.Quantity)</li>
                                        }
                                    </ul>
                                </div>
                                <div class="space-y-2">
                                    @if (order.Status == "pending")
                                    {
                                        <form method="post" action="/POS/UpdateOrderStatus" class="inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="orderId" value="@order.Id" />
                                            <input type="hidden" name="status" value="preparing" />
                                            <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                                                Start Cooking
                                            </button>
                                        </form>
                                    }
                                    else if (order.Status == "preparing")
                                    {
                                        <form method="post" action="/POS/UpdateOrderStatus" class="inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="orderId" value="@order.Id" />
                                            <input type="hidden" name="status" value="ready" />
                                            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                                                Mark Ready
                                            </button>
                                        </form>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
                <!-- Reports View -->
                <!-- Reports View -->
                <div id="reports-view" class="view hidden">
                    <h2 class="text-2xl font-bold mb-6">Daily Reports</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                            <h3 class="text-lg font-semibold text-gray-600">Today's Sales</h3>
                            <p class="text-3xl font-bold text-green-600">$@Model.TodaySales.ToString("F2")</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                            <h3 class="text-lg font-semibold text-gray-600">Total Orders</h3>
                            <p class="text-3xl font-bold text-blue-600">@Model.Orders.Count</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                            <h3 class="text-lg font-semibold text-gray-600">Completed</h3>
                            <p class="text-3xl font-bold text-green-600">@Model.Orders.Count(o => o.Status == "completed")</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                            <h3 class="text-lg font-semibold text-gray-600">Active</h3>
                            <p class="text-3xl font-bold text-orange-600">@Model.ActiveOrdersCount</p>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold mb-4">Recent Orders</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-2">Order ID</th>
                                        <th class="text-left py-2">Customer</th>
                                        <th class="text-left py-2">Type</th>
                                        <th class="text-left py-2">Total</th>
                                        <th class="text-left py-2">Status</th>
                                        <th class="text-left py-2">Time</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var order in Model.Orders.OrderByDescending(o => o.CreatedAt).Take(10))
                                    {
                                        <tr class="border-b">
                                            <!-- Fixed: Use OrderNumber instead of Id substring -->
                                            <td class="py-2">#@order.OrderNumber</td>
                                            <td class="py-2">@order.CustomerName</td>
                                            <td class="py-2">@order.OrderType</td>
                                            <td class="py-2">$@order.Total.ToString("F2")</td>
                                            <td class="py-2">
                                                <span class="px-2 py-1 rounded-full text-xs
                                    @(order.Status == "completed" ? "bg-green-100 text-green-800" :
                                      order.Status == "preparing" ? "bg-blue-100 text-blue-800" :
                                      "bg-yellow-100 text-yellow-800")">
                                                    @order.Status
                                                </span>
                                            </td>
                                            <td class="py-2">@order.CreatedAt.ToString("t")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Modals -->
        <!-- Replace the existing Add Table form with this -->
        <div id="addTableModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-8 rounded-xl max-w-md w-full mx-4 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">➕ Add New Table</h2>
                    <button type="button" onclick="closeModal('addTableModal')" class="text-gray-500 hover:text-gray-700 text-2xl">✕</button>
                </div>
                <form method="post" asp-action="AddTable" asp-controller="POS" class="space-y-4">
                    @Html.AntiForgeryToken()
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">🔢 Table Number</label>
                        <input type="number" id="newTableNumber" name="tableNumber" min="1" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">👥 Table Capacity</label>
                        <select name="capacity" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="2">2 seats</option>
                            <option value="4" selected>4 seats</option>
                            <option value="6">6 seats</option>
                            <option value="8">8 seats</option>
                            <option value="10">10 seats</option>
                            <option value="12">12 seats</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">📍 Location</label>
                        <select name="location" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="Main Dining">Main Dining</option>
                            <option value="Window Side">Window Side</option>
                            <option value="Patio">Patio</option>
                            <option value="Private Room">Private Room</option>
                            <option value="Bar Area">Bar Area</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">🏷️ Table Type</label>
                        <select name="type" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="Regular">Regular Table</option>
                            <option value="Booth">Booth</option>
                            <option value="High Top">High Top</option>
                            <option value="Round">Round Table</option>
                            <option value="Communal">Communal Table</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">📝 Notes (Optional)</label>
                        <textarea name="notes" placeholder="Any special notes about this table..." class="w-full p-3 border rounded-lg h-20 resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    <div class="flex space-x-4 mt-6">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 font-bold shadow-lg transform hover:scale-105 transition-all">
                            ✅ Create Table
                        </button>
                        <button type="button" onclick="closeModal('addTableModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-bold transition-all">
                            ❌ Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-8 rounded-xl max-w-md w-full mx-4 shadow-2xl">
                <h2 class="text-2xl font-bold mb-4">Process Payment</h2>
                <form method="post" action="/POS/CompletePayment" id="paymentForm">
                    <input type="hidden" name="orderId" id="paymentOrderId" />
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Payment Method:</label>
                        <select name="paymentMethod" class="w-full p-3 border rounded-lg">
                            <option value="cash">Cash</option>
                            <option value="card">Credit/Debit Card</option>
                            <option value="digital">Digital Wallet</option>
                        </select>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-bold">
                            Complete Payment
                        </button>
                        <button type="button" onclick="closeModal('paymentModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    }

    @if (TempData["Success"] != null)
    {
        <div class="notification success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="notification error">@TempData["Error"]</div>
    }

    <script>

                // Add Table Form Handling
        document.getElementById('addTableForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const data = {
                tableNumber: parseInt(formData.get('tableNumber')),
                capacity: parseInt(formData.get('capacity')),
                location: formData.get('location'),
                type: formData.get('type'),
                notes: formData.get('notes')
            };

            try {
                const response = await fetch('/POS/AddTable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    showNotification(result.message, 'success');
                    closeModal('addTableModal');
                    this.reset();
                    // Refresh the page to show new table
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Error adding table:', error);
                showNotification('Error adding table', 'error');
            }
        });

        // Auto-calculate next table number
        function showAddTableForm() {
            const existingTables = @Json.Serialize(Model.Tables.Select(t => t.Id).ToList());
            const nextTableNumber = existingTables.length > 0 ? Math.max(...existingTables) + 1 : 1;
            document.getElementById('newTableNumber').value = nextTableNumber;
            document.getElementById('addTableModal').classList.remove('hidden');
        }

                // AJAX function to add item to order
               // Enhanced AJAX function to add item to order
                      async function addToOrder(itemId, itemName) {
            console.log('Adding item to order:', itemId, itemName);

            try {
                const response = await fetch('/POS/AddToOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: `itemId=${itemId}`
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Add to order result:', result);

                    if (result.success) {
                        // Refresh the order panel to show the new item
                        await refreshOrderPanel();
                        showNotification(result.message, 'success');
                    } else {
                        showNotification(result.message, 'error');
                    }
                } else {
                    showNotification('Failed to add item to order', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error adding item to order', 'error');
            }
        }

        // Enhanced AJAX function to update quantity
        async function updateQuantity(itemId, change) {
            try {
                const response = await fetch('/POS/UpdateOrderQuantity', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: `itemId=${itemId}&change=${change}`
                });

                if (response.ok) {
                    await refreshOrderPanel();
                    showNotification('Order updated!', 'success');
                } else {
                    showNotification('Failed to update order', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error updating order', 'error');
            }
        }

        // Function to refresh the order panel via AJAX
               async function refreshOrderPanel() {
            console.log('Refreshing order panel...');

            try {
                const response = await fetch('/POS/GetCurrentOrderPartial');
                console.log('Partial view response status:', response.status);

                if (response.ok) {
                    const html = await response.text();
                    console.log('Received HTML:', html);

                    // Replace the entire order items container
                    const orderItemsContainer = document.getElementById('current-order-items');
                    if (orderItemsContainer) {
                        console.log('Found order items container, updating...');
                        orderItemsContainer.innerHTML = html;

                        // Also update totals
                        await updateOrderTotals();
                        updateProcessOrderButton();
                    } else {
                        console.error('Order items container not found!');
                    }
                } else {
                    console.error('Failed to fetch order partial');
                }
            } catch (error) {
                console.error('Error refreshing order panel:', error);
            }
        }

        // Function to update order totals via AJAX
                async function updateOrderTotals() {
            try {
                // Calculate totals from current items
                const currentOrder = await getCurrentOrderData();
                if (currentOrder) {
                    const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    const tax = subtotal * 0.10;
                    const total = subtotal + tax;

                    document.getElementById('subtotal-amount').textContent = `$${subtotal.toFixed(2)}`;
                    document.getElementById('tax-amount').textContent = `$${tax.toFixed(2)}`;
                    document.getElementById('total-amount').textContent = `$${total.toFixed(2)}`;
                }
            } catch (error) {
                console.error('Error updating order totals:', error);
            }
        }

        // Function to update process order button state
               function updateProcessOrderButton() {
            const processOrderBtn = document.getElementById('process-order-btn');
            const orderItemsContainer = document.getElementById('current-order-items');

            // Check if there are any order items
            const hasItems = orderItemsContainer.querySelector('.order-item') !== null ||
                            !orderItemsContainer.innerHTML.includes('No items added to order');

            if (processOrderBtn) {
                processOrderBtn.disabled = !hasItems;
            }
        }
        // Enhanced notification function
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
                function showAddTableForm() {
            // Calculate next available table number
            const existingTables = @Json.Serialize(Model.Tables.Select(t => t.Id).ToList());
            const nextTableNumber = existingTables.length > 0 ? Math.max(...existingTables) + 1 : 1;

            document.getElementById('newTableNumber').value = nextTableNumber;
            document.getElementById('addTableModal').classList.remove('hidden');
        }
        // View Management
        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });

            // Show selected view
            document.getElementById(viewName + '-view').classList.remove('hidden');

            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });

            // Find and activate current nav button
            const activeBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn =>
                btn.textContent.trim().toLowerCase() === viewName);
            if (activeBtn) {
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
                activeBtn.classList.add('bg-blue-600', 'text-white');
            }
        }

        // Modal Management
        function showAddTableForm() {
            document.getElementById('addTableModal').classList.remove('hidden');
        }

        function showPaymentModal(orderId) {
            document.getElementById('paymentOrderId').value = orderId;
            document.getElementById('paymentModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function filterMenu(category) {
            const items = document.querySelectorAll('.menu-item');
            items.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

                function showTableOptions(tableId) {
            const modal = document.getElementById('tableOptionsModal');
            document.getElementById('tableOptionsTableId').value = tableId;
            document.getElementById('tableOptionsNumber').textContent = tableId;

            // Reset forms
            hideReservationForm();
            document.getElementById('reservationFormData').reset();

            // Load table details and update UI
            loadTableDetails(tableId);
            modal.classList.remove('hidden');
        }

        function showAddMenuItemForm() {
            // Implementation for adding menu items
            alert('Add menu item form would open here');
        }

                // Enhanced table options functions
        function showTableOptions(tableId) {
            const modal = document.getElementById('tableOptionsModal');
            document.getElementById('tableOptionsTableId').value = tableId;
            document.getElementById('tableOptionsNumber').textContent = tableId;

            // Load table details and update UI
            loadTableDetails(tableId);
            modal.classList.remove('hidden');
        }

               async function loadTableDetails(tableId) {
            try {
                const response = await fetch(`/POS/GetTableDetails?tableId=${tableId}`);
                const result = await response.json();

                if (result.success) {
                    const table = result.table;

                    // Update status display
                    const statusElement = document.getElementById('tableCurrentStatus');
                    statusElement.textContent = table.status.charAt(0).toUpperCase() + table.status.slice(1);

                    // Update status color based on current status
                    updateStatusColor(statusElement, table.status);

                    // Show/hide relevant sections based on table status
                    updateUIForTableStatus(table.status, table.currentOrder, table.reservation);
                }
            } catch (error) {
                console.error('Error loading table details:', error);
                showNotification('Error loading table details', 'error');
            }
        }

                function updateUIForTableStatus(status, currentOrder, reservation) {
            // Hide all info sections first
            document.getElementById('currentOrderInfo').classList.add('hidden');
            document.getElementById('reservationInfo').classList.add('hidden');

            switch (status) {
                case 'available':
                    // Show reservation form if needed
                    break;
                case 'occupied':
                    showCurrentOrderInfo(currentOrder);
                    break;
                case 'reserved':
                    showReservationInfo(reservation);
                    break;
            }
        }
                function showCurrentOrderInfo(currentOrder) {
            const orderInfo = document.getElementById('currentOrderInfo');
            const orderContent = document.getElementById('orderDetailsContent');

            if (currentOrder) {
                orderContent.innerHTML = `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-semibold">Order #:</span>
                            <span>${currentOrder.orderNumber}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Customer:</span>
                            <span>${currentOrder.customerName || 'Walk-in'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Total:</span>
                            <span class="font-bold">$${currentOrder.total?.toFixed(2) || '0.00'}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Status:</span>
                            <span class="px-2 py-1 rounded text-xs ${
                                currentOrder.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                currentOrder.status === 'preparing' ? 'bg-blue-100 text-blue-800' :
                                'bg-green-100 text-green-800'
                            }">${currentOrder.status}</span>
                        </div>
                    </div>
                `;
                orderInfo.classList.remove('hidden');
            }
        }

        function showReservationInfo(reservation) {
            const reservationInfo = document.getElementById('reservationInfo');
            const reservationContent = document.getElementById('reservationDetailsContent');

            if (reservation) {
                reservationContent.innerHTML = `
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-semibold">Customer:</span>
                            <span>${reservation.customerName}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Phone:</span>
                            <span>${reservation.customerPhone}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Date & Time:</span>
                            <span>${new Date(reservation.reservationDateTime).toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Party Size:</span>
                            <span>${reservation.partySize} people</span>
                        </div>
                        ${reservation.specialRequests ? `
                        <div class="flex justify-between">
                            <span class="font-semibold">Special Requests:</span>
                            <span class="text-sm">${reservation.specialRequests}</span>
                        </div>` : ''}
                    </div>
                `;
                reservationInfo.classList.remove('hidden');
            }
        }

        // Reservation Functions
        function showReservationForm() {
            document.getElementById('reservationForm').classList.remove('hidden');

            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('input[name="reservationDate"]').min = today;

            // Set default time to next available slot (round to nearest 15 minutes)
            const now = new Date();
            const minutes = Math.ceil(now.getMinutes() / 15) * 15;
            now.setMinutes(minutes);
            now.setSeconds(0);
            document.querySelector('input[name="reservationTime"]').value = now.toTimeString().substring(0, 5);
        }

        function hideReservationForm() {
            document.getElementById('reservationForm').classList.add('hidden');
        }

        // Handle reservation form submission
        document.getElementById('reservationFormData').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const tableId = document.getElementById('tableOptionsTableId').value;

            const reservationData = {
                tableId: parseInt(tableId),
                customerName: formData.get('customerName'),
                customerPhone: formData.get('customerPhone'),
                reservationDate: formData.get('reservationDate'),
                reservationTime: formData.get('reservationTime'),
                partySize: parseInt(formData.get('partySize')),
                specialRequests: formData.get('specialRequests')
            };

            await createReservation(reservationData);
        });

        async function createReservation(reservationData) {
            try {
                const response = await fetch('/POS/CreateReservation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: JSON.stringify(reservationData)
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('Reservation created successfully!', 'success');
                    hideReservationForm();
                    closeModal('tableOptionsModal');
                    // Refresh the table display
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Error creating reservation:', error);
                showNotification('Error creating reservation', 'error');
            }
        }
                function updateStatusColor(element, status) {
            // Remove existing color classes
            element.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800', 'bg-white', 'text-blue-700');

            // Add new color classes based on status
            switch (status) {
                case 'available':
                    element.classList.add('bg-green-100', 'text-green-800');
                    break;
                case 'occupied':
                    element.classList.add('bg-red-100', 'text-red-800');
                    break;
                case 'reserved':
                    element.classList.add('bg-yellow-100', 'text-yellow-800');
                    break;
                default:
                    element.classList.add('bg-white', 'text-blue-700');
            }
        }


        function updateOptionsBasedOnStatus(status, currentOrder) {
            const startOrderCheckbox = document.getElementById('startNewOrder');
            const reserveCheckbox = document.getElementById('reserveTable');

            // Reset all checkboxes
            startOrderCheckbox.checked = false;
            reserveCheckbox.checked = false;

            switch (status) {
                case 'available':
                    // Available table - can start order or reserve
                    startOrderCheckbox.checked = true;
                    startOrderCheckbox.disabled = false;
                    reserveCheckbox.disabled = false;
                    break;
                case 'occupied':
                    // Occupied table - cannot start new order or reserve
                    startOrderCheckbox.checked = false;
                    startOrderCheckbox.disabled = true;
                    reserveCheckbox.disabled = true;
                    break;
                case 'reserved':
                    // Reserved table - cannot start order, can modify reservation
                    startOrderCheckbox.checked = false;
                    startOrderCheckbox.disabled = true;
                    reserveCheckbox.checked = true;
                    reserveCheckbox.disabled = false;
                    break;
            }
        }

        // Apply selected table options
        async function applyTableOptions() {
            const tableId = document.getElementById('tableOptionsTableId').value;
            const startNewOrder = document.getElementById('startNewOrder').checked;
            const reserveTable = document.getElementById('reserveTable').checked;
            const editSettings = document.getElementById('editTableSettings').checked;
            const viewHistory = document.getElementById('viewTableHistory').checked;

            try {
                // Handle reserve table
                if (reserveTable) {
                    await reserveTableAction(tableId);
                }

                // Handle start new order
                if (startNewOrder) {
                    await startNewOrderAction(tableId);
                }

                // Handle edit settings
                if (editSettings) {
                    await editTableSettingsAction(tableId);
                }

                // Handle view history
                if (viewHistory) {
                    await viewTableHistoryAction(tableId);
                }

                closeModal('tableOptionsModal');
                showNotification('Table options applied successfully', 'success');

                // Refresh the table display
                setTimeout(() => window.location.reload(), 1000);

            } catch (error) {
                console.error('Error applying table options:', error);
                showNotification('Error applying table options', 'error');
            }
        }

        // Individual action functions
        async function reserveTableAction(tableId) {
            try {
                const response = await fetch('/POS/UpdateTableStatus', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: `tableId=${tableId}&status=reserved`
                });

                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.message);
                }
            } catch (error) {
                throw new Error(`Reserve table failed: ${error.message}`);
            }
        }

        async function startNewOrderAction(tableId) {
            try {
                // First check if we have items in current order
                const currentOrder = await getCurrentOrderData();
                if (!currentOrder || !currentOrder.items || currentOrder.items.length === 0) {
                    // No items in current order, just assign the table
                    const response = await fetch('/POS/UpdateTableStatus', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                        },
                        body: `tableId=${tableId}&status=occupied`
                    });

                    const result = await response.json();
                    if (!result.success) {
                        throw new Error(result.message);
                    }

                    showNotification(`Table ${tableId} marked as occupied. Add items to start order.`, 'success');
                } else {
                    // We have items in current order, assign them to table
                    const response = await fetch('/POS/AssignOrderToTable', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                        },
                        body: `tableId=${tableId}`
                    });

                    const result = await response.json();
                    if (!result.success) {
                        throw new Error(result.message);
                    }
                }
            } catch (error) {
                throw new Error(`Start new order failed: ${error.message}`);
            }
        }

        async function editTableSettingsAction(tableId) {
            // Show edit table settings modal
            showEditTableModal(tableId);
        }

        async function viewTableHistoryAction(tableId) {
            // Show table history modal
            showTableHistoryModal(tableId);
        }

        // Additional modal functions
        function showEditTableModal(tableId) {
            // You can implement this similar to the add table modal
            // but pre-populated with existing table data
            alert(`Edit table settings for Table ${tableId} - This would open an edit form`);
        }

        function showTableHistoryModal(tableId) {
            // Show table order history
            alert(`View history for Table ${tableId} - This would show order history`);
        }

        // Enhanced table click handler
        function handleTableClick(tableId, tableStatus) {
            showTableOptions(tableId);
        }

        // Helper function to get current order data
               async function getCurrentOrderData() {
            try {
                // Since we're using session, we'll calculate from the DOM
                const orderItems = document.querySelectorAll('.order-item');
                const items = [];

                orderItems.forEach(item => {
                    const name = item.querySelector('.font-medium').textContent;
                    const priceText = item.querySelector('.text-sm').textContent;
                    const price = parseFloat(priceText.match(/\$([\d.]+)/)[1]);
                    const quantity = parseInt(item.querySelector('span:nth-child(2)').textContent);

                    items.push({
                        name: name,
                        price: price,
                        quantity: quantity,
                        total: price * quantity
                    });
                });

                return { items: items };
            } catch (error) {
                console.error('Error getting order data:', error);
            }
            return null;
        }

                async function startTableOrder() {
            const tableId = document.getElementById('tableOptionsTableId').value;

            try {
                const response = await fetch('/POS/StartTableOrder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: `tableId=${tableId}`
                });

                const result = await response.json();

                if (result.success) {
                    showNotification(`Order started for Table ${tableId}`, 'success');
                    closeModal('tableOptionsModal');
                    // Switch to menu view to add items
                    showView('menu');
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Error starting table order:', error);
                showNotification('Error starting order', 'error');
            }
        }

        // Additional action functions
        function editTableSettings() {
            const tableId = document.getElementById('tableOptionsTableId').value;
            alert(`Edit settings for Table ${tableId} - Open edit form`);
        }

        function viewTableHistory() {
            const tableId = document.getElementById('tableOptionsTableId').value;
            alert(`View history for Table ${tableId} - Show order history`);
        }

        function addMoreItems() {
            showView('menu');
            closeModal('tableOptionsModal');
        }

        async function closeTableOrder() {
            const tableId = document.getElementById('tableOptionsTableId').value;
            // Implement close order logic
            alert(`Close order for Table ${tableId} - Process payment`);
        }

        async function checkInReservation() {
            const tableId = document.getElementById('tableOptionsTableId').value;
            // Implement check-in logic
            alert(`Check in reservation for Table ${tableId}`);
        }

        async function cancelReservation() {
            const tableId = document.getElementById('tableOptionsTableId').value;
            // Implement cancel reservation logic
            alert(`Cancel reservation for Table ${tableId}`);
        }

        // Initialize dashboard view
        document.addEventListener('DOMContentLoaded', function() {
            showView('dashboard');

            // Update datetime every second
            function updateDateTime() {
                const now = new Date();
                const timeString = now.toLocaleString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true
                });

                const datetimeElement = document.getElementById('currentDateTime');
                if (datetimeElement) {
                    datetimeElement.textContent = timeString;
                }
            }

            setInterval(updateDateTime, 1000);
            updateDateTime();

            // Auto-hide notifications
            setTimeout(() => {
                const notifications = document.querySelectorAll('.notification');
                notifications.forEach(notification => {
                    notification.remove();
                });
            }, 3000);
        });

        // Order Management Functions
        let allOrders = [];
        let currentFilter = 'all';
        let currentStatusFilter = 'all';

        // Load orders when view is shown
        function showOrdersView() {
            loadAllOrders();
            showView('orders');
        }

        async function loadAllOrders() {
            try {
                showLoading('orders-container');

                const response = await fetch('/POS/GetAllOrders');
                const result = await response.json();

                if (result.success) {
                    allOrders = result.orders;
                    updateOrderStatistics();
                    filterOrders(currentFilter);
                } else {
                    showNotification('Error loading orders', 'error');
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                showNotification('Error loading orders', 'error');
            }
        }

        function updateOrderStatistics() {
            const allCount = allOrders.length;
            const dineInCount = allOrders.filter(o => o.orderType === 'dine-in').length;
            const deliveryCount = allOrders.filter(o => o.orderType === 'delivery').length;
            const takeawayCount = allOrders.filter(o => o.orderType === 'takeaway').length;

            document.getElementById('totalOrdersCount').textContent = allCount;
            document.getElementById('allOrdersCount').textContent = allCount;
            document.getElementById('dineInOrdersCount').textContent = dineInCount;
            document.getElementById('deliveryOrdersCount').textContent = deliveryCount;
            document.getElementById('takeawayOrdersCount').textContent = takeawayCount;
        }

        function filterOrders(orderType) {
            currentFilter = orderType;
            document.getElementById('orderTypeFilter').value = orderType;

            let filteredOrders = allOrders;

            // Filter by order type
            if (orderType !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.orderType === orderType);
            }

            // Apply status filter if set
            if (currentStatusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === currentStatusFilter);
            }

            displayOrders(filteredOrders);
        }

        function filterOrdersByStatus(status) {
            currentStatusFilter = status;
            filterOrders(currentFilter);
        }

        function filterOrdersByDate() {
            const dateFilter = document.getElementById('orderDateFilter').value;
            if (!dateFilter) {
                filterOrders(currentFilter);
                return;
            }

            let filteredOrders = allOrders.filter(order => {
                const orderDate = new Date(order.createdAt).toISOString().split('T')[0];
                return orderDate === dateFilter;
            });

            displayOrders(filteredOrders);
        }

        function searchOrders() {
            const searchTerm = document.getElementById('orderSearch').value.toLowerCase();

            if (!searchTerm) {
                filterOrders(currentFilter);
                return;
            }

            let filteredOrders = allOrders.filter(order =>
                order.orderNumber.toLowerCase().includes(searchTerm) ||
                order.customerName.toLowerCase().includes(searchTerm) ||
                (order.customerPhone && order.customerPhone.includes(searchTerm)) ||
                (order.tableId && `table ${order.tableId}`.includes(searchTerm))
            );

            displayOrders(filteredOrders);
        }

        function displayOrders(orders) {
            const container = document.getElementById('orders-container');
            const noOrdersMessage = document.getElementById('no-orders-message');

            if (orders.length === 0) {
                container.innerHTML = '';
                noOrdersMessage.classList.remove('hidden');
                return;
            }

            noOrdersMessage.classList.add('hidden');

            // Sort orders: pending first, then by creation time (newest first)
            const sortedOrders = orders.sort((a, b) => {
                if (a.status === 'pending' && b.status !== 'pending') return -1;
                if (a.status !== 'pending' && b.status === 'pending') return 1;
                return new Date(b.createdAt) - new Date(a.createdAt);
            });

            container.innerHTML = sortedOrders.map(order => `
                <div class="bg-white rounded-lg shadow-lg border border-gray-200 hover:shadow-xl transition-all order-card" data-order-type="${order.orderType}" data-status="${order.status}">
                    <!-- Order Header -->
                    <div class="bg-gradient-to-r ${getOrderTypeColor(order.orderType)} text-white p-4 rounded-t-lg">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-bold">${getOrderTypeIcon(order.orderType)} ${order.orderNumber}</h3>
                                <p class="text-sm opacity-90">${formatOrderType(order.orderType)}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-bold bg-white ${getStatusColor(order.status)}">
                                ${formatStatus(order.status)}
                            </span>
                        </div>
                    </div>

                    <!-- Order Details -->
                    <div class="p-4">
                        <div class="space-y-3 mb-4">
                            <div class="flex justify-between">
                                <span class="font-semibold text-gray-700">Customer:</span>
                                <span>${order.customerName || 'Walk-in'}</span>
                            </div>

                            ${order.customerPhone ? `
                            <div class="flex justify-between">
                                <span class="font-semibold text-gray-700">Phone:</span>
                                <span>${order.customerPhone}</span>
                            </div>` : ''}

                            ${order.tableId ? `
                            <div class="flex justify-between">
                                <span class="font-semibold text-gray-700">Table:</span>
                                <span class="font-bold">${order.tableId}</span>
                            </div>` : ''}

                            <div class="flex justify-between">
                                <span class="font-semibold text-gray-700">Time:</span>
                                <span class="text-sm">${new Date(order.createdAt).toLocaleTimeString()}</span>
                            </div>

                            <div class="border-t pt-3">
                                <div class="flex justify-between text-lg font-bold">
                                    <span>Total:</span>
                                    <span class="text-green-600">$${order.total.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="mb-4">
                            <h4 class="font-semibold text-gray-700 mb-2">Items (${order.items.length}):</h4>
                            <div class="space-y-2 max-h-32 overflow-y-auto">
                                ${order.items.map(item => `
                                    <div class="flex justify-between text-sm border-b pb-1">
                                        <span>${item.quantity}x ${item.name}</span>
                                        <span>$${(item.price * item.quantity).toFixed(2)}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="space-y-2">
                            ${getOrderActions(order)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getOrderTypeIcon(orderType) {
            switch (orderType) {
                case 'dine-in': return '🍽️';
                case 'delivery': return '🚚';
                case 'takeaway': return '🥡';
                default: return '📋';
            }
        }

        function getOrderTypeColor(orderType) {
            switch (orderType) {
                case 'dine-in': return 'from-green-600 to-green-700';
                case 'delivery': return 'from-purple-600 to-purple-700';
                case 'takeaway': return 'from-orange-600 to-orange-700';
                default: return 'from-blue-600 to-blue-700';
            }
        }

        function formatOrderType(orderType) {
            switch (orderType) {
                case 'dine-in': return 'Dine In';
                case 'delivery': return 'Delivery';
                case 'takeaway': return 'Take Away';
                default: return orderType;
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case 'pending': return 'text-yellow-800';
                case 'preparing': return 'text-blue-800';
                case 'ready': return 'text-green-800';
                case 'completed': return 'text-gray-800';
                case 'cancelled': return 'text-red-800';
                default: return 'text-gray-800';
            }
        }

        function formatStatus(status) {
            switch (status) {
                case 'pending': return '⏳ Pending';
                case 'preparing': return '👨‍🍳 Preparing';
                case 'ready': return '✅ Ready';
                case 'completed': return '📦 Completed';
                case 'cancelled': return '❌ Cancelled';
                default: return status;
            }
        }

        function getOrderActions(order) {
            let actions = '';

            switch (order.status) {
                case 'pending':
                    actions = `
                        <button onclick="updateOrderStatus(${order.id}, 'preparing')"
                                class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors">
                            👨‍🍳 Start Preparing
                        </button>
                        <button onclick="cancelOrder(${order.id})"
                                class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700 transition-colors">
                            ❌ Cancel Order
                        </button>
                    `;
                    break;

                case 'preparing':
                    actions = `
                        <button onclick="updateOrderStatus(${order.id}, 'ready')"
                                class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition-colors">
                            ✅ Mark Ready
                        </button>
                        <button onclick="updateOrderStatus(${order.id}, 'pending')"
                                class="w-full bg-yellow-600 text-white py-2 rounded hover:bg-yellow-700 transition-colors">
                            ↩️ Move Back
                        </button>
                    `;
                    break;

                case 'ready':
                    actions = `
                        <button onclick="completeOrder(${order.id})"
                                class="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700 transition-colors">
                            💳 Complete Order
                        </button>
                        ${order.orderType === 'delivery' ? `
                        <button onclick="assignDriver(${order.id})"
                                class="w-full bg-orange-600 text-white py-2 rounded hover:bg-orange-700 transition-colors">
                            🚗 Assign Driver
                        </button>
                        ` : ''}
                    `;
                    break;

                case 'completed':
                    actions = `
                        <button onclick="viewOrderReceipt(${order.id})"
                                class="w-full bg-gray-600 text-white py-2 rounded hover:bg-gray-700 transition-colors">
                            🧾 View Receipt
                        </button>
                        <button onclick="reopenOrder(${order.id})"
                                class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors">
                            🔄 Reopen
                        </button>
                    `;
                    break;
            }

            return actions;
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                const response = await fetch('/POS/UpdateOrderStatus', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: `orderId=${orderId}&status=${newStatus}`
                });

                const result = await response.json();

                if (result.success) {
                    showNotification(`Order status updated to ${newStatus}`, 'success');
                    await loadAllOrders(); // Refresh orders
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                showNotification('Error updating order status', 'error');
            }
        }

        function refreshOrders() {
            loadAllOrders();
            showNotification('Orders refreshed', 'success');
        }

        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="col-span-3 text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"></div>
                    <p class="mt-4 text-gray-600">Loading orders...</p>
                </div>
            `;
        }

        // Placeholder functions for other actions
        function cancelOrder(orderId) {
            if (confirm('Are you sure you want to cancel this order?')) {
                updateOrderStatus(orderId, 'cancelled');
            }
        }

        function completeOrder(orderId) {
            showPaymentModal(orderId);
        }

        function assignDriver(orderId) {
            alert(`Assign driver for order ${orderId}`);
        }

        function viewOrderReceipt(orderId) {
            alert(`View receipt for order ${orderId}`);
        }

        function reopenOrder(orderId) {
            if (confirm('Are you sure you want to reopen this completed order?')) {
                updateOrderStatus(orderId, 'pending');
            }
        }
                async function refreshOrderPanel() {
            try {
                const response = await fetch('/POS/GetCurrentOrderPartial');
                if (response.ok) {
                    const html = await response.text();
                    document.getElementById('current-order-items').innerHTML = html;
                    await updateOrderTotals();
                    updateProcessOrderButton();
                }
            } catch (error) {
                console.error('Error refreshing order panel:', error);
            }
        }
                async function clearOrder() {
            if (!confirm('Are you sure you want to clear the current order?')) {
                return;
            }

            try {
                const response = await fetch('/POS/ClearOrder', {
                    method: 'POST',
                    headers: {
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();

                if (result.success) {
                    await refreshOrderPanel();
                    showNotification('Order cleared!', 'success');
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Error clearing order:', error);
                showNotification('Error clearing order', 'error');
            }
        }
    </script>
</body>
</html>